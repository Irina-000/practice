
#include <iostream>
#include <fstream>
#include <vector>
#include <sstream>
#include <cmath>
#include <windows.h>
#include "ConWin.h"
#include <process.h>


    using namespace std;
extern HDC hdc; // объявим  контекст устройства

HDC hdc;	// Объявим контекст устройства
            // Контекст устройства по сути это структура,
            // содержащая описание видеокарты на вашем компьютере
            // и всех необходимых графических элементов



// размеры окна для графика
const int kolvo = 200;
const double discr_per = 5 * pow(10, -9) * pow(10, 9);   // период дискретизации (5)

int main(int argc, const char* argv[])
{

    ifstream inputFile("C:\\Users\\User\\Desktop\\практика\\просто_тесты\\1.txt"); //чтение из файла
    // если не существует этого файла
    if (!inputFile)
    {
        //вывод об ошибке
        cerr << "Error! Not exist!" << endl;
        return 1;
    }


    string test;
    getline(inputFile, test);   //перенос всего содержимого в одну строку
    inputFile.close();          //закрытие файла

    // Удаляем скобки
    // если первым символом явдяется скобка
    if (test.front() == '[')
    {
        test.erase(0, 1);
    }
    // если последним символом явдяется скобка
    if (test.back() == ']')
    {
        test.pop_back();
    }

    vector<double> numbers;     // вектор чисел
    stringstream str(test);     // переменная для перевода строки в набор чисел
    string number;

    while (getline(str, number, ','))       // вычленение чисел из строки, разделённых запятой
    {
        // добавление нового числа в конец вектора чисел
        numbers.push_back(stod(number));
    }

    int count = numbers.size();
    int i, j;
    cout << count << endl;
    cout << "Numbers:" << endl;
    for (i = 0; i < count; i++)
    {
        cout << numbers[i] << endl;
    }
    //for (i = 0; i < 45; i++)
    //{
    //    cout << endl;
    //}


    //получим дескриптор консольного окна
    HWND hwnd = GetConcolWindow();

    //если дескриптор существует
    if (hwnd != NULL)
    {
        //получим контекст устройства для консольного окна
        hdc = GetWindowDC(hwnd);

        //если контекст существует - можем работать
        if (hdc != 0)
        {
            int colR = 255;
            int colG = 0;
            int colB = 0;
            double x0 = 40;
            double y0 = 500;

            POINT coordX[2];
            POINT coordY[2];
            coordX[0].x = x0;
            coordX[0].y = y0;
            coordX[1].x = x0 + 1200;
            coordX[1].y = y0;

            coordY[0].x = x0;
            coordY[0].y = y0 + 300;
            coordY[1].x = x0;
            coordY[1].y = y0 - 400;

            Polyline(hdc, coordX, 2);
            Polyline(hdc, coordY, 2);

            HPEN Pen = CreatePen(PS_SOLID, 3, RGB(colR, colG, colB));
            SelectObject(hdc, Pen);
            HBRUSH hBrush = CreateSolidBrush(RGB(colR, colG, colB));
            SelectObject(hdc, hBrush);


            POINT poly[2];
            for (int i = 0; i < count - 1; i++)
            {
                poly[0].x = x0 + discr_per * i;
                poly[0].y = y0 - (numbers[i] * 30);

                poly[1].x = x0 + discr_per * (i + 1);
                poly[1].y = y0 - (numbers[i + 1] * 30);

                Polyline(hdc, poly, 2);
            }

        }
    }//end if



    return 0;
}

